<script>
  // Efek hujan hati lembut
  function createHeart() {
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = "ðŸ’–";
    heart.style.left = Math.random() * 100 + "vw";
    heart.style.animationDuration = 3 + Math.random() * 2 + "s";
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 5000);
  }
  setInterval(createHeart, 400);

  const chatBody = document.getElementById("chatBody");
  const userInput = document.getElementById("userInput");

  // Variabel untuk menyimpan nama user
  let userName = "";

  // Tambahkan sapaan awal otomatis
  window.onload = () => {
    setTimeout(() => {
      addMessage("Hallo~ ðŸ’Œ Apakah ada yang bisa dibantu? Bisakah beritahu nama kamu?", "bot");
    }, 700);
  };

  const responses = [
    { key: ["siapa kamu", "kamu siapa"], reply: "Aku CS Cinta ðŸ’Œ, tugasnya bantu kamu nemuin rasa yang hilang~" },
    { key: ["makasih", "thank"], reply: "Sama-sama sayang ðŸ’– jangan lupa balik ke halaman utama ya~" },
    { key: ["balik", "kembali"], reply: "Okeee~ aku antar balik ya ðŸ˜" },
    { key: ["clue", "bocoran"], reply: "Clue-nya: namanya diawali huruf N... kayak 'Nana' ðŸ˜˜" },
  ];

  function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;

    addMessage(text, "user");
    userInput.value = "";

    const lowerText = text.toLowerCase();

    // Jika user belum isi nama
    if (!userName) {
      const match = lowerText.match(/nama saya ([a-zA-Z]+)/i);
      if (match) {
        userName = match[1].charAt(0).toUpperCase() + match[1].slice(1);
        setTimeout(() => addMessage(`Hallo ${userName}~ senang bertemu denganmu ðŸ’– Apa yang bisa aku bantu?`, "bot"), 700);
        return;
      } else {
        setTimeout(() => addMessage("Boleh kasih tahu dulu namamu siapa? ðŸ¥°", "bot"), 700);
        return;
      }
    }

    // Setelah nama diketahui, bot mengenali jika user menyebut nama sendiri / aku / saya
    if (lowerText.includes(userName.toLowerCase()) || lowerText.includes("aku") || lowerText.includes("saya")) {
      setTimeout(() => addMessage(`Hehe iya ${userName}~ aku di sini kok ðŸ’ž`, "bot"), 700);
      return;
    }

    // Cek respon lain dari daftar
    let response = "Hmm... coba tanya dengan hati ðŸ˜š";
    for (const r of responses) {
      if (r.key.some(k => lowerText.includes(k))) {
        response = r.reply;
        break;
      }
    }

    setTimeout(() => addMessage(response, "bot"), 700);

    if (lowerText.includes("balik") || lowerText.includes("kembali")) {
      setTimeout(() => window.location.href = "index.html", 2000);
    }
  }

  function addMessage(text, sender) {
    const msg = document.createElement("div");
    msg.className = "message " + sender;

    const avatar = document.createElement("img");
    avatar.className = "avatar";
    avatar.src = sender === "bot"
      ? "https://i.ibb.co/4dKkDsh/cs-love.png"
      : "https://i.ibb.co/Gsvm6tL/user-love.png";

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    if (sender === "bot") {
      msg.appendChild(avatar);
      msg.appendChild(bubble);
    } else {
      msg.appendChild(bubble);
      msg.appendChild(avatar);
    }

    chatBody.appendChild(msg);
    chatBody.scrollTop = chatBody.scrollHeight;
  }
</script>
            
