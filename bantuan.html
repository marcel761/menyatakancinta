
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bantuan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background-color: #fdf2f8;
      overflow: hidden;
      color: #1f2937;
    }

    header {
      background-color: #ec4899;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 20;
    }

    #chat-container {
      position: absolute;
      top: 56px; /* tinggi header */
      bottom: 70px; /* tinggi footer */
      left: 0;
      right: 0;
      overflow-y: auto;
      padding: 1rem;
      background-color: #fdf2f8;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: #ec4899 #fdf2f8;
    }

    footer {
      background-color: #ec4899;
      border-top: 1px solid #f472b6;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      box-shadow: 0 -4px 10px rgba(236, 72, 153, 0.25);
      z-index: 20;
    }

    #user-input {
      background-color: #fce7f3;
      color: #1f2937;
    }

    #send-btn {
      background-color: #db2777;
    }
    #send-btn:hover {
      background-color: #be185d;
    }

    .chat-bubble.bg-blue-600 { background-color: #db2777 !important; }
    .chat-bubble.bg-gray-700 { background-color: #f9a8d4 !important; color: #1f2937; }

    #chat-placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #9ca3af;
      font-size: 0.95rem;
      opacity: 0.75;
      user-select: none;
      transition: opacity 0.3s ease;
    }

    #side-menu {
      transform: translateX(-100%);
      transition: transform 0.35s ease-in-out;
      background-color: #f9a8d4;
      color: #1f2937;
    }

    #side-menu.active { transform: translateX(0); }

    .chat-message { margin-bottom: 0.75rem; }
    .chat-bubble { max-width: 75%; border-radius: 1rem; }
    @media (min-width: 640px) { .chat-bubble { max-width: 60%; } }

    /* ðŸ’ž Efek konfeti cinta */
    .emoji {
      position: fixed;
      top: -2rem;
      font-size: 1.5rem;
      animation: fall linear forwards;
      z-index: 30;
      pointer-events: none;
      opacity: 0.9;
    }

    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    /* ðŸŽ€ Toggle switch animasi lembut */
    #romance-toggle:checked + div {
      background-color: #ec4899;
    }

    #romance-toggle:checked + div .dot {
      transform: translateX(1.25rem);
      transition: transform 0.3s cubic-bezier(0.4, 1.4, 0.4, 1);
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="text-white py-3 px-4 shadow-md flex items-center justify-center relative">
    <button id="menu-btn" class="absolute left-4 focus:outline-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
    <h1 class="text-lg font-semibold text-center">ðŸ’¬ Customer Service</h1>
    <a href="index.html" class="absolute right-4 text-sm text-white hover:text-gray-200">Kembali</a>
  </header>

  <!-- Sidebar Menu -->
  <aside id="side-menu" class="fixed top-0 left-0 w-64 h-full p-5 shadow-lg z-50">
    <h2 class="text-lg font-semibold mb-4">Menu</h2>
    <ul class="space-y-3">
      <li><button id="new-chat" class="w-full text-left hover:text-pink-700">ðŸ†• Obrolan Baru</button></li>
    </ul>
    
    <!-- ðŸ”¹ Bagian bawah menu -->
    <div class="absolute bottom-6 left-0 w-full px-5 space-y-3">
      <hr class="border-pink-400 mb-3">
      <!-- ðŸ’– Romance Mode -->
      <div class="flex items-center justify-between">
        <span>ðŸ’– Romance Mode</span>
        <label class="inline-flex items-center cursor-pointer">
          <input type="checkbox" id="romance-toggle" class="sr-only peer">
          <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-pink-500 relative transition">
            <div class="dot absolute top-[2px] left-[2px] bg-white w-5 h-5 rounded-full transition-transform peer-checked:translate-x-full"></div>
          </div>
        </label>
      </div>
    </div>
  </aside>

  <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-40 z-40"></div>

  <!-- Chat -->
  <main id="chat-container">
    <div id="chat-placeholder">ðŸ’­ Mulai obrolan dengan Asisten Marcel...</div>
  </main>

  <!-- Input -->
  <footer class="flex items-center space-x-2 p-3">
    <input id="user-input" type="text" placeholder="Ketik pesan..." class="flex-1 p-3 rounded-xl outline-none focus:ring-2 focus:ring-pink-400" />
    <button id="send-btn" class="hover:bg-pink-700 px-4 py-3 rounded-xl font-medium text-white">Kirim</button>
  </footer>

  <script>
  const botAvatar = "robot.png";  
  const userAvatar = "user.png";  
  const chatContainer = document.getElementById("chat-container");
  const sendBtn = document.getElementById("send-btn");
  const userInput = document.getElementById("user-input");
  const menuBtn = document.getElementById("menu-btn");
  const sideMenu = document.getElementById("side-menu");
  const overlay = document.getElementById("overlay");
  const newChatBtn = document.getElementById("new-chat");
  const romanceToggle = document.getElementById("romance-toggle");

  // ===== Rule-based Sapaan =====
  const sapaanUmum = ["hai", "halo", "hei", "hey", "hay", "heii", "heyyy", "woi", "oi", "yo"];
  const responUmum = [
    "Hai juga! ðŸ‘‹ Ada yang bisa aku bantu?",
    "Halo juga! Senang disapa ðŸ˜„",
    "Hey hey! Gimana kabarnya hari ini?",
    "Hai! Aku di sini siap bantu kamu âœ¨"
  ];

  const sapaanFormal = ["selamat pagi", "selamat siang", "selamat sore", "selamat malam"];
  function responFormal(text) {
    if (text.includes("pagi")) return "Selamat pagi juga â˜€ï¸ Semoga harimu menyenangkan!";
    if (text.includes("siang")) return "Selamat siang juga ðŸ˜„ Semoga hari ini produktif!";
    if (text.includes("sore")) return "Selamat sore ðŸŒ‡ Waktunya bersantai!";
    if (text.includes("malam")) return "Selamat malam ðŸŒ™ Waktunya istirahat ya!";
  }

  const sapaanReligius = ["assalamualaikum", "assalamu'alaikum", "shalom", "om swastiastu", "salam sejahtera"];
  function responReligius(text) {
    if (text.includes("assalam")) return "Waalaikumsalam ðŸ˜Š";
    if (text.includes("shalom")) return "Shalom juga ðŸ™";
    if (text.includes("swastiastu")) return "Om Shanti Shanti Om ðŸ™";
    if (text.includes("salam sejahtera")) return "Salam sejahtera juga ðŸ™";
  }

  const aliasSapaan = {
    "p": "hai",
    "pa": "hai",
    "permisi": "hai",
    "misi": "hai",
    "bro": "hai",
    "cuuy": "hai",
    "cuy": "hai",
    "gess": "hai",
    "ges": "hai",
    "bray": "hai",
    "bang": "hai",
    "kak": "hai",
    "mas": "hai",
    "sis": "hai",
    "pagiii": "selamat pagi",
    "haloo": "halo",
    "halloo": "halo",
    "halooo": "halo"
    
  };

  // ðŸ”¹ Tambahan: Preprocessor slang gabungan
  function normalizeSlangSentence(sentence) {
    sentence = sentence
    .toLowerCase()
    .replace(/[^\w\s\u00C0-\u017F]/g, "") // buang tanda baca & emoji
    .trim();

  const words = sentence.split(/\s+/);
  const converted = words.map(w => aliasSapaan[w] || w);

  const joined = converted.join(" ");
  if (joined.match(/(hai|halo|selamat pagi|assalamualaikum|shalom|swastiastu|salam sejahtera)/)) {
    if (joined.includes("assalamualaikum")) return "assalamualaikum";
    if (joined.includes("selamat pagi")) return "selamat pagi";
    if (joined.includes("halo")) return "halo";
    if (joined.includes("shalom")) return "shalom";
    if (joined.includes("swastiastu")) return "om swastiastu";
    if (joined.includes("salam sejahtera")) return "salam sejahtera";
    return "hai"; // fallback umum
  }
  return joined;
  }

  // âœ… Pindahkan fungsi similarity ke atas (biar bisa dipakai global)
  function levenshtein(a, b) {
    const m = [];
    for (let i = 0; i <= b.length; i++) m[i] = [i];
    for (let j = 0; j <= a.length; j++) m[0][j] = j;
    for (let i = 1; i <= b.length; i++) {
      for (let j = 1; j <= a.length; j++) {
        m[i][j] = b[i - 1] === a[j - 1]
          ? m[i - 1][j - 1]
          : Math.min(m[i - 1][j - 1] + 1, m[i][j - 1] + 1, m[i - 1][j] + 1);
      }
    }
    return m[b.length][a.length];
  }

  function similarity(a, b) {
    const longer = a.length > b.length ? a : b;
    const shorter = a.length > b.length ? b : a;
    const dist = levenshtein(longer, shorter);
    return (longer.length - dist) / longer.length;
  }

  function isSimilarToAny(text, list, threshold = 0.7) {
    return list.some(item => similarity(text, item) >= threshold);
  }

  // ðŸ§  Fungsi utama chatbot
  function getBotReply(text) {
    text = text.toLowerCase().replace(/[^\w\s]/gi, "").trim();
    if (aliasSapaan[text]) text = aliasSapaan[text];

    if (isSimilarToAny(text, sapaanUmum)) {
      return responUmum[Math.floor(Math.random() * responUmum.length)];
    }
    if (isSimilarToAny(text, sapaanFormal)) {
      return responFormal(text);
    }
    if (isSimilarToAny(text, sapaanReligius)) {
      return responReligius(text);
    }
    return "Terima kasih atas pesanmu! Fitur lainnya masih dalam pengembangan ðŸ¤–";
  }

  sendBtn.addEventListener("click", sendMessage);
  userInput.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

  function sendMessage() {
    let text = userInput.value.trim();
    if (text === "") return;
    const placeholder = document.getElementById("chat-placeholder");
    if (placeholder) placeholder.remove();

    const userMessage = document.createElement("div");
    userMessage.className = "flex justify-end items-start chat-message space-x-2";
    userMessage.innerHTML = `
     <div class='chat-bubble bg-blue-600 p-3 rounded-2xl rounded-tr-none'>
       <p>${text}</p>
     </div>
     <img src="${userAvatar}" alt="User" class="w-8 h-8 rounded-full self-end">
    `;
    chatContainer.appendChild(userMessage);
    userInput.value = "";
    scrollToBottom();

    showTypingAnimation();
    setTimeout(() => {
      removeTypingAnimation();
      text = normalizeSlangSentence(text);
      const reply = getBotReply(text);
      showBotMessage(reply);
    }, 1000);
  }
</script>

<script>

    function showTypingAnimation() {
      const typingDiv = document.createElement("div");
      typingDiv.id = "typing";
      typingDiv.className = "flex items-start chat-message";
      typingDiv.innerHTML = `<div class='chat-bubble bg-gray-700 p-3 rounded-2xl rounded-tl-none flex items-center space-x-1 typing-dots'>
        <span class="w-2 h-2 bg-gray-400 rounded-full inline-block"></span>
        <span class="w-2 h-2 bg-gray-400 rounded-full inline-block"></span>
        <span class="w-2 h-2 bg-gray-400 rounded-full inline-block"></span>
      </div>`;
      chatContainer.appendChild(typingDiv);
      scrollToBottom();
    }

    function removeTypingAnimation() {
      const typingDiv = document.getElementById("typing");
      if (typingDiv) typingDiv.remove();
    }

    function showBotMessage(text) {
      const botMessage = document.createElement("div");
      botMessage.className = "flex items-start chat-message space-x-2";
      botMessage.innerHTML = `
        <img src="${botAvatar}" alt="Bot" class="w-8 h-8 rounded-full self-end">
        <div class='chat-bubble bg-gray-700 p-3 rounded-2xl rounded-tl-none'>
         <p>${text}</p>
        </div>
      `;
      chatContainer.appendChild(botMessage);
      scrollToBottom();
    }

    function scrollToBottom() { chatContainer.scrollTop = chatContainer.scrollHeight; }

    menuBtn.addEventListener("click", () => {
      sideMenu.classList.toggle("active");
      overlay.classList.toggle("hidden");
    });
    overlay.addEventListener("click", () => {
      sideMenu.classList.remove("active");
      overlay.classList.add("hidden");
    });

    newChatBtn.addEventListener("click", () => {
      chatContainer.innerHTML = `<div id="chat-placeholder">ðŸ’­ Mulai obrolan dengan Asisten Marcel...</div>`;
      sideMenu.classList.remove("active");
      overlay.classList.add("hidden");
    });

    window.addEventListener("load", () => {
      const isOn = localStorage.getItem("romanceMode") === "true";
      romanceToggle.checked = isOn;
      if (isOn) startRomance();
    });

    romanceToggle.addEventListener("change", () => {
      const isOn = romanceToggle.checked;
      localStorage.setItem("romanceMode", isOn);
      if (isOn) startRomance();
    });

    function startRomance() {
      const emojis = ["ðŸ’–", "ðŸ’˜", "ðŸ’•", "ðŸ’ž", "ðŸ’«", "âœ¨", "ðŸŒ¸", "ðŸ’“"];
      const interval = setInterval(() => {
        if (!romanceToggle.checked) return clearInterval(interval);
        const emoji = document.createElement("div");
        emoji.className = "emoji";
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = Math.random() * 100 + "vw";
        emoji.style.animationDuration = (3 + Math.random() * 3) + "s";
        document.body.appendChild(emoji);
        setTimeout(() => emoji.remove(), 6000);
      }, 150);
    }
  </script>
</body>
</html>
